{%- liquid
  assign desktop_height = section.settings.height
  assign mobile_height = section.settings.mobile_height
  assign width = section.settings.width
  
  assign animation_anchor = '#CompareSection--' | append: section.id
  assign animation_order = 0
  assign bg_color = section.settings.bg_color
  assign bg_color_transparent = bg_color | color_modify: 'alpha', 0
  assign text_color = section.settings.color

  capture style
    echo '--PT: ' | append: section.settings.padding_top | append: 'px;'
    echo '--PB: ' | append: section.settings.padding_bottom | append: 'px;'
    echo '--outer: ' | append: section.settings.padding_lr | append: ' px;'

    unless bg_color == 'rgba(0,0,0,0)' or bg_color == blank
      echo '--bg: ' | append: bg_color | append: ';'
      echo '--bg-transparent: ' | append: bg_color_transparent | append: ';'
    endunless

    unless text_color == 'rgba(0,0,0,0)' or text_color == blank
      assign text_light = text_color | color_mix: settings.bg_color, 70
      assign text_dark = text_color | color_saturate: 10 | color_darken: 15
      echo '--text: ' | append: text_color | append: ';'
      echo '--text-light: ' | append: text_light | append: ';'
      echo '--text-dark: ' | append: text_dark | append: ';'
    endunless
  endcapture

  assign figure_width_class = ''
  if table_width == 'three-quarters'
    assign figure_width_class = ' table__block--three-quarters'
  endif
  
  capture alignment
    if section.settings.text_alignment == 'text-left'
      echo ' align--middle-left'
    else
      echo ' align--middle-center'
    endif
  endcapture
-%}

{% capture popup_content %}
  <div class="{{ width }}">
    <div class="comparision-wrapper">
      <div class="comparision-text">
        <div class="comparision-heading">
          <p class="caption-text">{{ section.settings.caption }}</p>
          <h3 class="heading-text">{{ section.settings.heading }}</h3>
        </div>
        <div class="comparision-details">
          <div class="comparision-details-text">
            <h4 class="sub-heading-text">{{ section.settings.sub_heading }}</h4>
            {{ section.settings.description }}
          </div>
          <a href="{{ section.settings.btn_link.url }}" class="btn btn--secondary btn--solid">{{ section.settings.btn_text }}</a>
        </div>
      </div>
      <div class="comparision-table">
        <div id="cd-table">
          <header class="cd-table-column">
            <div class="header-row">
              {{ 'product-1' | placeholder_svg_tag }}
              <h2>&nbsp;</h2>
            </div>
            {%- assign properties_data = section.settings.items_detail | split: ',' -%}
            <ul>
              {% for property in properties_data %}
                {%- assign properties_count = forloop.length -%}
                <li>{{ property }}</li>
              {% endfor %}
            </ul>
          </header>
          <div class="cd-table-container">
            <div class="cd-table-wrapper">
              {% for block in section.blocks %}
                <div class="cd-table-column">
                  <div class="header-row">
                    {% if block.settings.image != blank %}
                      {{ block.settings.image | image_url: width: '640' | image_tag }}
                    {% else %}
                    {{ 'product-1' | placeholder_svg_tag }}
                    {% endif %}
                    <h2>{{ block.settings.title }}</h2>
                  </div>
                  <ul>
                    {%- assign block_properties = block.settings.properties | split: ',' -%}
                    {% for i in (1..properties_count) %}
                      {%- assign current_value = block_properties[i] | downcase -%}
                      {% if current_value == 'yes' %}
                        <li><span class="green-dot"></span></li>
                      {% else %}
                        <li></li>
                      {% endif %}
                    {% endfor %}
                  </ul>
                </div>
              {% endfor %}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
{% endcapture %}
{% capture section_content %}
  <div class="{{ width }}">
    <div class="comparision-wrapper">
      <div class="comparision-heading">
        <p class="caption-text">{{ section.settings.caption }}</p>
        <h3 class="heading-text">{{ section.settings.heading }}</h3>
      </div>
      <div class="comparision-table">
        <div id="cd-table">
          <header class="cd-table-column">
            <div class="header-row">
              {{ 'product-1' | placeholder_svg_tag }}
              <h2>&nbsp;</h2>
            </div>
            {%- assign properties_data = section.settings.items_detail | split: ',' -%}
            <ul>
              {% for property in properties_data %}
                {%- assign properties_count = forloop.length -%}
                <li>{{ property }}</li>
              {% endfor %}
            </ul>
          </header>
          <div class="cd-table-container">
            <div class="cd-table-wrapper">
              {% for block in section.blocks %}
                <div class="cd-table-column">
                  <div class="header-row">
                    {% if block.settings.image != blank %}
                      {{ block.settings.image | image_url: width: '640' | image_tag }}
                    {% else %}
                    {{ 'product-1' | placeholder_svg_tag }}
                    {% endif %}
                    <h2>{{ block.settings.title }}</h2>
                  </div>
                  <ul>
                    {%- assign block_properties = block.settings.properties | split: ',' -%}
                    {% for i in (1..properties_count) %}
                      {%- assign current_value = block_properties[i] | downcase -%}
                      {% if current_value == 'yes' %}
                        <li><span class="green-dot"></span></li>
                      {% else %}
                        <li></li>
                      {% endif %}
                    {% endfor %}
                  </ul>
                </div>
              {% endfor %}
            </div>
          </div>
        </div>
      </div>
      <div class="comparision-details">
          <div class="comparision-details-text">
            <h4 class="sub-heading-text">{{ section.settings.sub_heading }}</h4>
            {{ section.settings.description }}
          </div>
          <a href="{{ section.settings.btn_link.url }}" class="btn btn--secondary btn--solid">{{ section.settings.btn_text }}</a>
        </div>
    </div>
  </div>
{% endcapture %}
<style>
  #cd-table {
    position: relative;
    width: 90%;
    max-width: 1440px;
    margin: auto;
    font-size: 0.875rem;
  }
  #cd-table::after {
    content: "";
    display: table;
    clear: both;
  }
  #cd-table .cd-table-container {
    position: relative;
    width: 100%;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }
  #cd-table .cd-table-wrapper {
    width: 870px;
    padding-left: 120px;
  }
  #cd-table .cd-table-column {
      width: 150px;
      float: left;
      margin-left: -1px;
  }
  #cd-table .cd-table-column ul {
      margin: 0;
  }
  #cd-table h2,
  #cd-table ul>li {
      position: relative;
      text-align: center;
      padding: 0 1em;
      height: 56px;
      line-height: 56px;
      margin: 0;
  }
  #cd-table h2 {
      font-size: 14px;
      font-size: 0.875rem;
      text-transform: uppercase;
      font-weight: bold;
      color: #121212;
  }
  #cd-table ul>li {
      color: #121212;
      list-style: none;
  }
  #cd-table header.cd-table-column {
      position: absolute;
      width: 120px;
      height: 100%;
      left: 0;
      top: 0;
      z-index: 10;
      margin-left: 0;
      pointer-events: none;
  }
  .cd-table-wrapper .cd-table-column:nth-child(odd),
  #cd-table .cd-table-column li:nth-child(odd) {
      background: rgba(0, 0, 0, 0.025);
  }
  #cd-table header.cd-table-column h2,
  #cd-table header.cd-table-column li {
      background-color: transparent;
      text-align: left;
      color: #121212;
  }
  #cd-table .cd-table-column li {
    display: flex;
    justify-content: center;
    align-items: center;
  }
  span.green-dot {
    height: 1rem;
    width: 1rem;
    display: block;
    border-radius: 50rem;
    background: var(--BTN-SECONDARY-BG-COLOR);
  }
  #cd-table header.cd-table-column h2 {
      color: #121212;
  }
  @media only screen and (min-width: 870px) {
      #cd-table {
          border-right: none;
      }
      #cd-table::before {
          display: none;
      }
      #cd-table .cd-table-wrapper {
          width: 100%;
          padding-left: 25%;
      }
      #cd-table .cd-table-column {
          width: 33.33%;
          float: left;
      }
      #cd-table header.cd-table-column {
          width: 25%;
          float: left;
          box-shadow: none;
          pointer-events: auto;
      }
      #cd-table .cd-scroll-right {
          display: none;
      }
  }
  .comparision-system {
    display: flex;
    justify-content: center;
    align-items: center;
  }
  .comparision-wrapper {
      display: flex;
      width: 1440px;
  }
  .comparision-text {
      width: calc(25% - 4rem);
      padding: 0 2rem;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
  }
  .comparision-text .caption-text {
      margin-bottom: 0;
      text-transform: uppercase;
  }
  .comparision-text .heading-text {
      margin-top: 0;
  }
  .comparision-table {
    width: 75%;
  }
  header.cd-table-column .header-row svg {
      opacity: 0;
      visibility: hidden;
  }
  .header-row {
      min-height: 10rem;
      display: flex;
      flex-direction: column;
  }
  .header-row img,
  .header-row svg {
      max-height: 8rem;
      margin: 0 auto;
      width: auto;
  }
  .comparision-details-text {
      margin-bottom: 2rem;
  }
</style>

<section 
  id="ComparisionSection--{{ section.id }}"
  data-section-id="{{ section.id }}"
  data-section-type="comparision"
  class="comparision-system index-comparision section-padding {{ section.settings.text_alignment }} {{ desktop_height }} {{ mobile_height }}"
  style="{{ style }}"
  >
  {{ section_content }}
</section>

<product-modal class="product__block block-padding" style=" --block-padding-bottom: 30px;">
  <div class="product__icon__container product__icon__container--full">
    <a class="radio__legend__link text-link" data-popup-open {{ section.shopify_attributes }}>
      Compare our Systems
    </a>
  </div>

  <dialog class="product-modal" aria-hidden="true" inert data-scroll-lock-required>
    <form method="dialog">
      <button class="visually-hidden no-js" aria-label="{{ 'general.accessibility.close' | t }}"></button>
    </form>

    <div style='max-width: 1440px' class="product-modal__outer prod-modal__container">
      <div class="product-modal__content small product-modal__container" data-scroll-lock-scrollable>
        <button type="button" class="product-modal__close" data-popup-close autofocus aria-label="{{ 'general.accessibility.close' | t }}">
          {%- render 'icon-cancel' -%}
        </button>
        {{ popup_content }}
      </div>
    </div>
  </dialog>
</product-modal>
{{ 'https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.7.1/modernizr.min.js' | script_tag }}
{{ 'https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js' | script_tag }}
<script>
    jQuery(document).ready(function($){
  	var $columns_number = $('#cd-table .cd-table-container').find('.cd-table-column').length;

  	$('.cd-table-container').on('scroll', function(){
  		$this = $(this);
  		//hide the arrow on scrolling
  		if( $this.scrollLeft() > 0 ) {
  			$('.cd-scroll-right').hide();
  		}
  		//remove color gradient when table has scrolled to the end
  		var total_table_width = parseInt($('.cd-table-wrapper').css('width').replace('px', '')),
  			table_viewport = parseInt($('#cd-table').css('width').replace('px', ''));

  		if( $this.scrollLeft() >= total_table_width - table_viewport - $columns_number) {
  			$('#cd-table').addClass('table-end');
  		} else {
  			$('#cd-table').removeClass('table-end');
  		}
  	});

  	//scroll the table (scroll value equal to column width) when clicking on the .cd-scroll-right arrow
   	$('.cd-scroll-right').on('click', function(){
   		$this= $(this);
   		var column_width = $(this).siblings('.cd-table-container').find('.cd-table-column').eq(0).css('width').replace('px', ''),
   			new_left_scroll = parseInt($('.cd-table-container').scrollLeft()) + parseInt(column_width);

   		$('.cd-table-container').animate( {scrollLeft: new_left_scroll}, 200 );
   		$this.hide();
   	});
  });
</script>

{% schema %}
{
  "name": "Compare Systems - Tiege",
  "settings": [
    {
      "type": "header",
      "content": "Section Settings"
    },
    {
      "type": "select",
      "id": "height",
      "label": "Desktop height",
      "default": "screen-height-three-quarters",
      "options": [
        { "value": "screen-height-full", "label": "Full screen height"},
        { "value": "screen-height-three-quarters", "label": "3/4 of screen"},
        { "value": "screen-height-two-thirds", "label": "2/3 of screen"},
        { "value": "screen-height-one-half", "label": "1/2 of screen"},
        { "value": "screen-height-one-third", "label": "1/3 of screen"},
        { "value": "seven-fifty-height-hero", "label": "750px" },
        { "value": "sixty-fifty-height-hero", "label": "650px" },
        { "value": "five-fifty-height-hero", "label": "550px" },
        { "value": "four-fifty-height-hero", "label": "450px" }
      ]
    },
    {
      "type": "select",
      "id": "mobile_height",
      "label": "Mobile height",
      "default": "screen-height-one-half--mobile",
      "options": [
        { "value": "screen-height-full--mobile", "label": "Full screen height"},
        { "value": "screen-height-three-quarters--mobile", "label": "3/4 of screen"},
        { "value": "screen-height-two-thirds--mobile", "label": "2/3 of screen"},
        { "value": "screen-height-one-half--mobile", "label": "1/2 of screen"},
        { "value": "screen-height-one-third--mobile", "label": "1/3 of screen"},
        { "value": "seven-fifty-height-hero--mobile", "label": "750px" },
        { "value": "sixty-fifty-height-hero--mobile", "label": "650px" },
        { "value": "five-fifty-height-hero--mobile", "label": "550px" },
        { "value": "four-fifty-height-hero--mobile", "label": "450px" }
      ]
    },
    {
      "type": "select",
      "id": "width",
      "label": "Width",
      "default": "wrapper--full",
      "options": [
        {"value": "wrapper--full", "label": "Full width"},
        {"value": "wrapper--full-padded", "label": "Full width padded"},
        {"value": "wrapper", "label": "Normal"}
      ]
    },
    {
      "type": "header",
      "content": "Text"
    },
    {
      "type": "select",
      "id": "text_alignment",
      "label": "Alignment",
      "default": "text-left",
      "options": [
        {"value": "text-left","label": "Left"},
        {"value": "text-center","label": "Centered"}
      ]
    },
    {
      "type": "range",
      "id": "padding_lr",
      "min": 0,
      "max": 125,
      "step": 5,
      "unit": "px",
      "label": "Padding Left/Right",
      "default": 50
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Background"
    },
    {
      "type": "color",
      "id": "color",
      "label": "Text"
    },
    {
      "type": "header",
      "content": "Section padding"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 200,
      "step": 2,
      "unit": "px",
      "label": "Padding top",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 200,
      "step": 2,
      "unit": "px",
      "label": "Padding bottom",
      "default": 0
    },
    {
      "type": "header",
      "content": "Section Content"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Compare Our Systems"
    },
    {
      "type": "text",
      "id": "caption",
      "label": "Caption",
      "default": "Level Guide"
    },
    {
      "type": "text",
      "id": "sub_heading",
      "label": "Sub Heading",
      "default": "Level Guide"
    },
    {
      "type": "richtext",
      "id": "description",
      "label": "Description",
      "default": "<p>Lorem Ipsum</p>"
    },
    {
      "type": "text",
      "id": "btn_text",
      "label": "Link Text",
      "default": "Take our Quiz"
    },
    {
      "type": "url",
      "id": "btn_link",
      "label" : "Link URL"
    },
    {
      "type": "header",
      "content": "Properties"
    },
    {
      "type":"text",
      "id" : "items_detail",
      "label" : "Comparables",
      "default": "Wash,Scrub,AM,PM,Eyes,Serum",
      "info": "Please add a comma seperated list of properties to compare"
    }
  ],
  "blocks": [
    {
      "type": "item",
      "name": "Product Item",
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "Title",
          "default": "Level 1"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "text",
          "id": "properties",
          "label": "Properties",
          "default": "Yes,Yes,Yes,No,No",
          "info": "Info for text item"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Compare Systems - Tiege",
      "blocks": [
        {
          "type": "item"
        },
        {
          "type": "item"
        }
      ]
    }
  ],
  "disabled_on": {
    "groups": ["header", "aside", "footer"]
  }
}
{% endschema %}
{% layout none %}
{% capture jsonData %}
{
  isRoutine: {{ product.metafields.custom.is_routine.value }},
  {% if product.metafields.custom.next_level_routine != blank %}
    nextRoutine : {
      id : {{ product.metafields.custom.next_level_routine.value.id }},
      handle : "{{ product.metafields.custom.next_level_routine.value.handle }}"
    },
  {% else %}
    nextRoutine: false,
  {% endif %}
  {% if product.metafields.custom.next_routine_line_item != blank %}
    nextRoutineLineItem : {
      id : {{ product.metafields.custom.next_routine_line_item.value.id }},
      details : {{ product.metafields.custom.next_routine_line_item.value | json }}
    },
  {% else %}
    nextRoutineLineItem: false,
  {% endif %}
  {% if product.metafields.custom.products_included_in_routine != blank %}
    routineVariants: [
      {% for variant in product.metafields.custom.products_included_in_routine %}
        {
          id: {{ variant.id }},
          detail: {{ variant | json }}
        },
      {% endfor %}
    ]
  {% else %}
    routineVariants : []
  {% endif %}
}
{% endcapture %}
{{- jsonData -}}